{"ast":null,"code":"import React,{useState}from'react';import'./ConfirmationModal.css';import apiService from'../services/api';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function ConfirmationModal(_ref){let{isOpen,onClose,plan,tariffId,formatDateEnd,userId}=_ref;const[isPaying,setIsPaying]=useState(false);const[payError,setPayError]=useState(null);if(!isOpen)return null;const dateEnd=plan&&formatDateEnd?formatDateEnd(plan.months):'';const monthWord=plan&&plan.months===1?'месяц':plan&&plan.months>=2&&plan.months<=4?'месяца':'месяцев';const subscriptionText=plan?\"\\u041F\\u043E\\u0434\\u043F\\u0438\\u0441\\u043A\\u0430 \\u0434\\u043E \".concat(dateEnd,\", \").concat(plan.months,\" \").concat(monthWord):'';const deviceCount=2;const displayPrice=plan?plan.price:0;const durationDays=plan?Math.round(plan.months*30.44):30;const tariffPlan=tariffId==='pro'?'pro':'basic';const returnUrl=typeof window!=='undefined'?window.location.origin+'/':'';const handlePay=async()=>{if(!userId||!plan||isPaying)return;setIsPaying(true);setPayError(null);try{const res=await apiService.subscriptionCheckout({userid:userId,tariff_plan:tariffPlan,duration_days:durationDays,amount:String(plan.price),return_url:returnUrl});if(res&&res.confirmation_url){window.location.href=res.confirmation_url;return;}setPayError('Не удалось получить ссылку на оплату');}catch(e){setPayError(e.message||'Ошибка при создании платежа');}finally{setIsPaying(false);}};return/*#__PURE__*/_jsx(\"div\",{className:\"confirmation-overlay\",onClick:onClose,children:/*#__PURE__*/_jsxs(\"div\",{className:\"confirmation-modal\",onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"confirmation-header\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"confirmation-title\",children:\"\\u041F\\u043E\\u0434\\u0442\\u0432\\u0435\\u0440\\u0436\\u0434\\u0435\\u043D\\u0438\\u0435\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"confirmation-close\",onClick:onClose,children:/*#__PURE__*/_jsx(\"svg\",{width:\"24\",height:\"24\",viewBox:\"0 0 24 24\",fill:\"none\",xmlns:\"http://www.w3.org/2000/svg\",children:/*#__PURE__*/_jsx(\"path\",{d:\"M18 6L6 18M6 6L18 18\",stroke:\"white\",strokeWidth:\"2\",strokeLinecap:\"round\"})})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"confirmation-body\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"confirmation-row\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"confirmation-label\",children:\"\\u041F\\u043E\\u0434\\u043F\\u0438\\u0441\\u043A\\u0430\"}),/*#__PURE__*/_jsx(\"span\",{className:\"confirmation-value\",children:subscriptionText})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"confirmation-row\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"confirmation-label\",children:\"\\u041A\\u043E\\u043B\\u0438\\u0447\\u0435\\u0441\\u0442\\u0432\\u043E \\u0443\\u0441\\u0442\\u0440\\u043E\\u0439\\u0441\\u0442\\u0432\"}),/*#__PURE__*/_jsx(\"span\",{className:\"confirmation-value\",children:deviceCount})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"confirmation-row confirmation-payment-row\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"confirmation-payment-method\",children:[/*#__PURE__*/_jsxs(\"svg\",{className:\"confirmation-card-icon\",width:\"24\",height:\"24\",viewBox:\"0 0 24 24\",fill:\"none\",xmlns:\"http://www.w3.org/2000/svg\",children:[/*#__PURE__*/_jsx(\"rect\",{x:\"2\",y:\"5\",width:\"20\",height:\"14\",rx:\"2\",stroke:\"white\",strokeWidth:\"2\"}),/*#__PURE__*/_jsx(\"path\",{d:\"M2 10H22\",stroke:\"white\",strokeWidth:\"2\",strokeLinecap:\"round\"})]}),/*#__PURE__*/_jsx(\"span\",{className:\"confirmation-payment-text\",children:\"\\u041E\\u043F\\u043B\\u0430\\u0442\\u0430 \\u043D\\u043E\\u0432\\u043E\\u0439 \\u043A\\u0430\\u0440\\u0442\\u043E\\u0439\"})]}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"confirmation-change-link\",children:\"\\u0418\\u0437\\u043C\\u0435\\u043D\\u0438\\u0442\\u044C >\"})]}),payError&&/*#__PURE__*/_jsx(\"p\",{className:\"confirmation-error\",children:payError}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"confirmation-pay-button\",onClick:handlePay,disabled:isPaying||!userId,children:isPaying?'Загрузка…':\"\\u041E\\u043F\\u043B\\u0430\\u0442\\u0438\\u0442\\u044C \".concat(displayPrice,\" \\u0420\")})]})]})});}export default ConfirmationModal;","map":{"version":3,"names":["React","useState","apiService","jsx","_jsx","jsxs","_jsxs","ConfirmationModal","_ref","isOpen","onClose","plan","tariffId","formatDateEnd","userId","isPaying","setIsPaying","payError","setPayError","dateEnd","months","monthWord","subscriptionText","concat","deviceCount","displayPrice","price","durationDays","Math","round","tariffPlan","returnUrl","window","location","origin","handlePay","res","subscriptionCheckout","userid","tariff_plan","duration_days","amount","String","return_url","confirmation_url","href","e","message","className","onClick","children","stopPropagation","type","width","height","viewBox","fill","xmlns","d","stroke","strokeWidth","strokeLinecap","x","y","rx","disabled"],"sources":["/Users/nikitamozaev/Desktop/beznet_miniapp/front/src/components/ConfirmationModal.js"],"sourcesContent":["import React, { useState } from 'react';\nimport './ConfirmationModal.css';\nimport apiService from '../services/api';\n\nfunction ConfirmationModal({ isOpen, onClose, plan, tariffId, formatDateEnd, userId }) {\n  const [isPaying, setIsPaying] = useState(false);\n  const [payError, setPayError] = useState(null);\n\n  if (!isOpen) return null;\n\n  const dateEnd = plan && formatDateEnd ? formatDateEnd(plan.months) : '';\n  const monthWord = plan && plan.months === 1 ? 'месяц' : (plan && plan.months >= 2 && plan.months <= 4 ? 'месяца' : 'месяцев');\n  const subscriptionText = plan\n    ? `Подписка до ${dateEnd}, ${plan.months} ${monthWord}`\n    : '';\n\n  const deviceCount = 2;\n  const displayPrice = plan ? plan.price : 0;\n\n  const durationDays = plan ? Math.round(plan.months * 30.44) : 30;\n  const tariffPlan = tariffId === 'pro' ? 'pro' : 'basic';\n  const returnUrl = typeof window !== 'undefined' ? window.location.origin + '/' : '';\n\n  const handlePay = async () => {\n    if (!userId || !plan || isPaying) return;\n    setIsPaying(true);\n    setPayError(null);\n    try {\n      const res = await apiService.subscriptionCheckout({\n        userid: userId,\n        tariff_plan: tariffPlan,\n        duration_days: durationDays,\n        amount: String(plan.price),\n        return_url: returnUrl,\n      });\n      if (res && res.confirmation_url) {\n        window.location.href = res.confirmation_url;\n        return;\n      }\n      setPayError('Не удалось получить ссылку на оплату');\n    } catch (e) {\n      setPayError(e.message || 'Ошибка при создании платежа');\n    } finally {\n      setIsPaying(false);\n    }\n  };\n\n  return (\n    <div className=\"confirmation-overlay\" onClick={onClose}>\n      <div className=\"confirmation-modal\" onClick={(e) => e.stopPropagation()}>\n        <div className=\"confirmation-header\">\n          <h2 className=\"confirmation-title\">Подтверждение</h2>\n          <button type=\"button\" className=\"confirmation-close\" onClick={onClose}>\n            <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n              <path d=\"M18 6L6 18M6 6L18 18\" stroke=\"white\" strokeWidth=\"2\" strokeLinecap=\"round\"/>\n            </svg>\n          </button>\n        </div>\n\n        <div className=\"confirmation-body\">\n          <div className=\"confirmation-row\">\n            <span className=\"confirmation-label\">Подписка</span>\n            <span className=\"confirmation-value\">{subscriptionText}</span>\n          </div>\n          <div className=\"confirmation-row\">\n            <span className=\"confirmation-label\">Количество устройств</span>\n            <span className=\"confirmation-value\">{deviceCount}</span>\n          </div>\n          <div className=\"confirmation-row confirmation-payment-row\">\n            <div className=\"confirmation-payment-method\">\n              <svg className=\"confirmation-card-icon\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                <rect x=\"2\" y=\"5\" width=\"20\" height=\"14\" rx=\"2\" stroke=\"white\" strokeWidth=\"2\"/>\n                <path d=\"M2 10H22\" stroke=\"white\" strokeWidth=\"2\" strokeLinecap=\"round\"/>\n              </svg>\n              <span className=\"confirmation-payment-text\">Оплата новой картой</span>\n            </div>\n            <button type=\"button\" className=\"confirmation-change-link\">Изменить &gt;</button>\n          </div>\n\n          {payError && (\n            <p className=\"confirmation-error\">{payError}</p>\n          )}\n          <button\n            type=\"button\"\n            className=\"confirmation-pay-button\"\n            onClick={handlePay}\n            disabled={isPaying || !userId}\n          >\n            {isPaying ? 'Загрузка…' : `Оплатить ${displayPrice} Р`}\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default ConfirmationModal;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}