{"ast":null,"code":"import React,{useState,useEffect}from'react';import'./TransactionsModal.css';import apiService from'../services/api';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function formatDate(str){if(!str)return'—';try{const d=new Date(str);if(Number.isNaN(d.getTime()))return str;const day=d.getDate();const month=d.getMonth()+1;const year=d.getFullYear();const h=d.getHours();const m=d.getMinutes();return\"\".concat(day.toString().padStart(2,'0'),\".\").concat(month.toString().padStart(2,'0'),\".\").concat(year,\" \").concat(h.toString().padStart(2,'0'),\":\").concat(m.toString().padStart(2,'0'));}catch(_unused){return str;}}function statusLabel(s){if(!s)return'—';const t=String(s).toLowerCase();if(t==='succeeded')return'Оплачено';if(t==='pending')return'В ожидании';if(t==='canceled'||t==='cancelled')return'Отменено';if(t==='failed')return'Ошибка';return s;}function TransactionsModal(_ref){let{isOpen,onClose,userId}=_ref;const[transactions,setTransactions]=useState([]);const[loading,setLoading]=useState(false);useEffect(()=>{if(!isOpen||userId==null||userId==='')return;let cancelled=false;setLoading(true);setTransactions([]);(async()=>{try{const res=await apiService.getTransactions(String(userId));if(cancelled)return;const list=Array.isArray(res===null||res===void 0?void 0:res.transactions)?res.transactions:[];setTransactions(list);}catch(_){if(!cancelled)setTransactions([]);}finally{if(!cancelled)setLoading(false);}})();return()=>{cancelled=true;};},[isOpen,userId]);if(!isOpen)return null;return/*#__PURE__*/_jsx(\"div\",{className:\"transactions-overlay\",onClick:onClose,children:/*#__PURE__*/_jsxs(\"div\",{className:\"transactions-sheet\",onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"transactions-header\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"transactions-title\",children:\"\\u041C\\u043E\\u0438 \\u0442\\u0440\\u0430\\u043D\\u0437\\u0430\\u043A\\u0446\\u0438\\u0438\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"transactions-close\",onClick:onClose,children:/*#__PURE__*/_jsx(\"svg\",{width:\"24\",height:\"24\",viewBox:\"0 0 24 24\",fill:\"none\",xmlns:\"http://www.w3.org/2000/svg\",children:/*#__PURE__*/_jsx(\"path\",{d:\"M18 6L6 18M6 6L18 18\",stroke:\"white\",strokeWidth:\"2\",strokeLinecap:\"round\"})})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"transactions-body\",children:[loading&&/*#__PURE__*/_jsx(\"div\",{className:\"transactions-empty\",children:/*#__PURE__*/_jsx(\"span\",{className:\"transactions-empty-text\",children:\"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0430\\u2026\"})}),!loading&&transactions.length===0&&/*#__PURE__*/_jsxs(\"div\",{className:\"transactions-empty\",children:[/*#__PURE__*/_jsxs(\"svg\",{className:\"transactions-empty-icon\",width:\"64\",height:\"64\",viewBox:\"0 0 64 64\",fill:\"none\",xmlns:\"http://www.w3.org/2000/svg\",children:[/*#__PURE__*/_jsx(\"rect\",{x:\"12\",y:\"8\",width:\"40\",height:\"44\",rx:\"4\",stroke:\"white\",strokeWidth:\"2\"}),/*#__PURE__*/_jsx(\"path\",{d:\"M12 24H52\",stroke:\"white\",strokeWidth:\"2\",strokeLinecap:\"round\"}),/*#__PURE__*/_jsx(\"path\",{d:\"M20 32H44\",stroke:\"white\",strokeWidth:\"1.5\",strokeLinecap:\"round\"}),/*#__PURE__*/_jsx(\"path\",{d:\"M20 40H44\",stroke:\"white\",strokeWidth:\"1.5\",strokeLinecap:\"round\"})]}),/*#__PURE__*/_jsx(\"span\",{className:\"transactions-empty-text\",children:\"\\u0415\\u0449\\u0451 \\u043D\\u0435\\u0442 \\u0442\\u0440\\u0430\\u043D\\u0437\\u0430\\u043A\\u0446\\u0438\\u0439\"})]}),!loading&&transactions.length>0&&/*#__PURE__*/_jsx(\"ul\",{className:\"transactions-list\",children:transactions.map(t=>{var _t$payment_id;return/*#__PURE__*/_jsxs(\"li\",{className:\"transactions-item\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"transactions-item-row\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"transactions-item-amount\",children:t.amount!=null?\"\".concat(t.amount,\" \\u0420\"):'—'}),/*#__PURE__*/_jsx(\"span\",{className:\"transactions-item-status transactions-item-status-\".concat(String(t.status||'').toLowerCase()),children:statusLabel(t.status)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"transactions-item-meta\",children:[t.tariff_plan&&/*#__PURE__*/_jsx(\"span\",{children:t.tariff_plan}),t.duration_days!=null&&/*#__PURE__*/_jsxs(\"span\",{children:[t.duration_days,\" \\u0434\\u043D.\"]}),/*#__PURE__*/_jsx(\"span\",{children:formatDate(t.created_at)})]})]},(_t$payment_id=t.payment_id)!==null&&_t$payment_id!==void 0?_t$payment_id:String(t.created_at)+t.amount);})})]})]})});}export default TransactionsModal;","map":{"version":3,"names":["React","useState","useEffect","apiService","jsx","_jsx","jsxs","_jsxs","formatDate","str","d","Date","Number","isNaN","getTime","day","getDate","month","getMonth","year","getFullYear","h","getHours","m","getMinutes","concat","toString","padStart","_unused","statusLabel","s","t","String","toLowerCase","TransactionsModal","_ref","isOpen","onClose","userId","transactions","setTransactions","loading","setLoading","cancelled","res","getTransactions","list","Array","isArray","_","className","onClick","children","e","stopPropagation","type","width","height","viewBox","fill","xmlns","stroke","strokeWidth","strokeLinecap","length","x","y","rx","map","_t$payment_id","amount","status","tariff_plan","duration_days","created_at","payment_id"],"sources":["/Users/nikitamozaev/Desktop/beznet_miniapp/front/src/components/TransactionsModal.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport './TransactionsModal.css';\nimport apiService from '../services/api';\n\nfunction formatDate(str) {\n  if (!str) return '—';\n  try {\n    const d = new Date(str);\n    if (Number.isNaN(d.getTime())) return str;\n    const day = d.getDate();\n    const month = d.getMonth() + 1;\n    const year = d.getFullYear();\n    const h = d.getHours();\n    const m = d.getMinutes();\n    return `${day.toString().padStart(2, '0')}.${month.toString().padStart(2, '0')}.${year} ${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}`;\n  } catch {\n    return str;\n  }\n}\n\nfunction statusLabel(s) {\n  if (!s) return '—';\n  const t = String(s).toLowerCase();\n  if (t === 'succeeded') return 'Оплачено';\n  if (t === 'pending') return 'В ожидании';\n  if (t === 'canceled' || t === 'cancelled') return 'Отменено';\n  if (t === 'failed') return 'Ошибка';\n  return s;\n}\n\nfunction TransactionsModal({ isOpen, onClose, userId }) {\n  const [transactions, setTransactions] = useState([]);\n  const [loading, setLoading] = useState(false);\n\n  useEffect(() => {\n    if (!isOpen || userId == null || userId === '') return;\n    let cancelled = false;\n    setLoading(true);\n    setTransactions([]);\n    (async () => {\n      try {\n        const res = await apiService.getTransactions(String(userId));\n        if (cancelled) return;\n        const list = Array.isArray(res?.transactions) ? res.transactions : [];\n        setTransactions(list);\n      } catch (_) {\n        if (!cancelled) setTransactions([]);\n      } finally {\n        if (!cancelled) setLoading(false);\n      }\n    })();\n    return () => { cancelled = true; };\n  }, [isOpen, userId]);\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"transactions-overlay\" onClick={onClose}>\n      <div\n        className=\"transactions-sheet\"\n        onClick={(e) => e.stopPropagation()}\n      >\n        <div className=\"transactions-header\">\n          <h2 className=\"transactions-title\">Мои транзакции</h2>\n          <button type=\"button\" className=\"transactions-close\" onClick={onClose}>\n            <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n              <path d=\"M18 6L6 18M6 6L18 18\" stroke=\"white\" strokeWidth=\"2\" strokeLinecap=\"round\"/>\n            </svg>\n          </button>\n        </div>\n\n        <div className=\"transactions-body\">\n          {loading && (\n            <div className=\"transactions-empty\">\n              <span className=\"transactions-empty-text\">Загрузка…</span>\n            </div>\n          )}\n          {!loading && transactions.length === 0 && (\n            <div className=\"transactions-empty\">\n              <svg\n                className=\"transactions-empty-icon\"\n                width=\"64\"\n                height=\"64\"\n                viewBox=\"0 0 64 64\"\n                fill=\"none\"\n                xmlns=\"http://www.w3.org/2000/svg\"\n              >\n                <rect x=\"12\" y=\"8\" width=\"40\" height=\"44\" rx=\"4\" stroke=\"white\" strokeWidth=\"2\"/>\n                <path d=\"M12 24H52\" stroke=\"white\" strokeWidth=\"2\" strokeLinecap=\"round\"/>\n                <path d=\"M20 32H44\" stroke=\"white\" strokeWidth=\"1.5\" strokeLinecap=\"round\"/>\n                <path d=\"M20 40H44\" stroke=\"white\" strokeWidth=\"1.5\" strokeLinecap=\"round\"/>\n              </svg>\n              <span className=\"transactions-empty-text\">Ещё нет транзакций</span>\n            </div>\n          )}\n          {!loading && transactions.length > 0 && (\n            <ul className=\"transactions-list\">\n              {transactions.map((t) => (\n                <li key={t.payment_id ?? String(t.created_at) + t.amount} className=\"transactions-item\">\n                  <div className=\"transactions-item-row\">\n                    <span className=\"transactions-item-amount\">{t.amount != null ? `${t.amount} Р` : '—'}</span>\n                    <span className={`transactions-item-status transactions-item-status-${String(t.status || '').toLowerCase()}`}>\n                      {statusLabel(t.status)}\n                    </span>\n                  </div>\n                  <div className=\"transactions-item-meta\">\n                    {t.tariff_plan && <span>{t.tariff_plan}</span>}\n                    {t.duration_days != null && <span>{t.duration_days} дн.</span>}\n                    <span>{formatDate(t.created_at)}</span>\n                  </div>\n                </li>\n              ))}\n            </ul>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default TransactionsModal;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}